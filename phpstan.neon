includes:
    - ./vendor/larastan/larastan/extension.neon

parameters:
    level: 8
    paths:
        - src

    # Laravel/Larastan specific settings
    checkModelProperties: true
    checkOctaneCompatibility: true
    noUnnecessaryCollectionCall: true
    noUnnecessaryCollectionCallOnly: ['all', 'get', 'toArray']
    noUnnecessaryCollectionCallExcept: []
    noModelMake: false  # Disabled because we're a model generator
    checkModelAppends: true
    checkPhpDocMissingReturn: true
    checkUnusedViews: false
    noEnvCallsOutsideOfConfig: true

    # Disable migration/schema scanning as this is a package
    disableMigrationScan: true
    disableSchemaScan: true

    # Core PHPStan settings
    treatPhpDocTypesAsCertain: true
    checkMissingIterableValueType: true
    checkGenericClassInNonGenericObjectType: true
    checkMissingCallableSignature: true
    reportUnmatchedIgnoredErrors: true

    # Paths to exclude from analysis
    excludePaths:
        - tests/tmp/*
        - tests/*
        - build/*
        - vendor/*
        - '*.blade.php'

    tmpDir: build/phpstan

    # Error patterns to ignore
    ignoreErrors:
        # Laravel model property access
        - message: '#Access to an undefined property .+Model::\$.+#'
          paths:
            - src/Models/*
            - src/Support/Traits/*

        # Laravel model method calls
        - message: '#Call to an undefined method .+Model::.+#'
          paths:
            - src/Models/*
            - src/Support/Traits/*

        # Schema builder dynamic methods
        - message: '#Call to an undefined method Illuminate\\Database\\Schema\\Builder::#'
          paths:
            - src/Services/Schema/*

        # Console output methods
        - message: '#Method .+writeln\(\) invoked with 1 parameter, 2 required#'
          paths:
            - src/Console/Commands/*

        # Factory method calls
        - message: '#Call to static method factory\(\) on an unknown class#'
          paths:
            - src/Support/Factories/*

        # Allow dynamic properties in value objects
        - message: '#Access to an undefined property#'
          paths:
            - src/ValueObjects/*

        # Allow dynamic method calls in template engine
        - message: '#Call to an undefined method#'
          paths:
            - src/Services/ModelGeneratorTemplateEngine.php

    # Early terminating function calls
    earlyTerminatingFunctionCalls:
        - abort
        - dd
        - dump
        - exit
        - die

    # Universal object crates
    universalObjectCratesClasses:
        - Illuminate\Http\Request
        - Illuminate\Support\Optional
        - SAC\EloquentModelGenerator\ValueObjects\Column
        - SAC\EloquentModelGenerator\ValueObjects\ModelDefinition

    # Mixin exclusions
    mixinExcludeClasses:
        - Eloquent
        - Illuminate\Database\Eloquent\Model

    # Core checks
    checkUnionTypes: true
    checkImplicitMixed: true
    checkBenevolentUnionTypes: true

    # Package specific settings
    rememberPossiblyImpureFunctionValues: false
    checkPhpDocMethodSignatures: true
    checkExplicitMixed: true
    inferPrivatePropertyTypeFromConstructor: true
    reportMaybesInMethodSignatures: true
    reportStaticMethodSignatures: true
